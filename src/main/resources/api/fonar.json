{"openapi":"3.0.1","info":{"title":"Fonar Messenging Protocol","version":"1.0-alpha.0"},"servers":[{"url":"http://localhost:20777","description":"Generated server url"}],"tags":[{"name":"message","description":"API to send and retrieve messages"},{"name":"user","description":"API to get users and update user profile"}],"paths":{"/v1.0/message/seen":{"put":{"tags":["message"],"summary":"Mark message as seen","operationId":"seenMessage","parameters":[{"name":"userId","in":"query","description":"Id of conversation (user id)","required":true,"schema":{"type":"integer","format":"int64"}},{"name":"messageId","in":"query","description":"Id of message to mark as seen","required":true,"schema":{"type":"integer","format":"int64"}}],"responses":{"404":{"description":"Message was not found"},"200":{"description":"Message has been successfully marked as seen"},"409":{"description":"Message is already seen"}},"security":[{"fonarAuth":[]}]}},"/v1.0/user/photo":{"get":{"tags":["user"],"summary":"Get user avatar thumbnail","operationId":"getPhoto","parameters":[{"name":"uid","in":"query","description":"Id of user","required":true,"schema":{"type":"integer","format":"int64"}}],"responses":{"404":{"description":"No user was found by id","content":{"image/jpeg":{"schema":{"type":"array","items":{"type":"string","format":"byte"}}}}},"200":{"description":"Avatar thumbnail retrieved","content":{"image/jpeg":{}}}},"security":[{"fonarAuth":[]}]},"post":{"tags":["user"],"summary":"Upload user avatar thumbnail","operationId":"uploadImage","requestBody":{"content":{"multipart/form-data":{"schema":{"required":["image"],"type":"object","properties":{"image":{"type":"string","description":"Id of user","format":"binary"}}}}}},"responses":{"413":{"description":"Image is too large (> 100 KB)"},"201":{"description":"Avatar thumbnail was uploaded"},"415":{"description":"Image is malformed"}},"security":[{"fonarAuth":[]}]}},"/v1.0/user/info":{"get":{"tags":["user"],"summary":"Get user profile information","operationId":"getUserInfo","parameters":[{"name":"userId","in":"query","description":"Id of user","required":true,"schema":{"type":"integer","format":"int64"}}],"responses":{"404":{"description":"User was not found on this server","content":{"application/json":{"schema":{"$ref":"#/components/schemas/User"}}}},"200":{"description":"User profile retrieved","content":{"application/json":{}}}},"security":[{"fonarAuth":[]}]},"post":{"tags":["user"],"summary":"Update user profile","operationId":"updateUserInfo","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/UpdateUserProfile"}}},"required":true},"responses":{"409":{"description":"User with proposed nickname already exists on this server","content":{"application/json":{"schema":{"$ref":"#/components/schemas/User"}}}},"201":{"description":"List of users on this server","content":{"application/json":{"schema":{"type":"array","items":{"$ref":"#/components/schemas/User"}}}}}},"security":[{"fonarAuth":[]}]}},"/v1.0/message":{"post":{"tags":["message"],"summary":"Send message to conversation","operationId":"postMessage","parameters":[{"name":"userId","in":"query","description":"Id of conversation (user id) message is sent to","required":true,"schema":{"type":"integer","format":"int64"}}],"requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/SendMessageDto"}}},"required":true},"responses":{"404":{"description":"No conversation was found","content":{"*/*":{"schema":{"$ref":"#/components/schemas/Message"}}}},"409":{"description":"This user does not accept messages","content":{"*/*":{"schema":{"$ref":"#/components/schemas/Message"}}}},"201":{"description":"Message has been successfully sent","content":{"application/json":{"schema":{"$ref":"#/components/schemas/Message"}}}}},"security":[{"fonarAuth":[]}]}},"/version":{"get":{"tags":["connection-controller"],"summary":"Get server configuration","operationId":"about","responses":{"200":{"description":"Configuration is retrieved","content":{"application/json":{"schema":{"$ref":"#/components/schemas/FonarConfiguration"}}}}}}},"/v1.0/users":{"get":{"tags":["user"],"summary":"Get list of users","operationId":"getUsers","parameters":[{"name":"quantity","in":"query","description":"Number of messages to be retrieved","required":false,"schema":{"type":"integer","format":"int64","default":20}},{"name":"offset","in":"query","description":"Offset of retrieved messages","required":false,"schema":{"type":"integer","format":"int64","default":0}}],"responses":{"200":{"description":"List of users on this server","content":{"application/json":{"schema":{"type":"array","items":{"$ref":"#/components/schemas/User"}}}}}},"security":[{"fonarAuth":[]}]}},"/v1.0/me":{"get":{"tags":["user"],"summary":"Get my user profile","operationId":"getMe","responses":{"200":{"description":"User profile retrieved","content":{"application/json":{}}}},"security":[{"fonarAuth":[]}]}},"/v1.0/dialogs":{"get":{"tags":["message"],"summary":"Get list of dialogs sorted in date descending","operationId":"getDialogs","parameters":[{"name":"quantity","in":"query","description":"Number of messages to be retrieved","required":false,"schema":{"type":"integer","format":"int64","default":20}},{"name":"offset","in":"query","description":"Offset of retrieved messages","required":false,"schema":{"type":"integer","format":"int64","default":0}}],"responses":{"200":{"description":"List of dialogs","content":{"application/json":{"schema":{"type":"array","items":{"$ref":"#/components/schemas/DialogDto"}}}}}},"security":[{"fonarAuth":[]}]}},"/v1.0/dialog":{"get":{"tags":["message"],"summary":"Get messages within dialog in descending order","operationId":"getDialog","parameters":[{"name":"userId","in":"query","description":"Id of conversation (user id)","required":true,"schema":{"type":"integer","format":"int64"}},{"name":"quantity","in":"query","description":"Number of messages to be retrieved","required":false,"schema":{"type":"integer","format":"int64","default":20}},{"name":"offset","in":"query","description":"Offset of retrieved messages","required":false,"schema":{"type":"integer","format":"int64","default":0}}],"responses":{"404":{"description":"No conversation was found","content":{"application/json":{"schema":{"type":"array","items":{"$ref":"#/components/schemas/Message"}}}}},"200":{"description":"List of dialogs","content":{"application/json":{"schema":{"type":"array","items":{"$ref":"#/components/schemas/Message"}}}}}},"security":[{"fonarAuth":[]}]}},"/register":{"get":{"tags":["connection-controller"],"summary":"Register on this server","operationId":"register","parameters":[{"name":"key","in":"query","description":"Secret randomly generated sha-512 key in hex containing server salt and client GUID","required":true,"schema":{"type":"string"}}],"responses":{"200":{"description":"User is already registered","content":{"application/json":{"schema":{"$ref":"#/components/schemas/User"}}}},"201":{"description":"User has been registered","content":{"application/json":{"schema":{"$ref":"#/components/schemas/User"}}}},"403":{"description":"Registration is not available","content":{"application/json":{"schema":{"$ref":"#/components/schemas/User"}}}}}}}},"components":{"schemas":{"UpdateUserProfile":{"required":["firstname","nickname"],"type":"object","properties":{"firstname":{"type":"string"},"lastname":{"type":"string"},"bio":{"type":"string"},"nickname":{"type":"string"}},"description":"UpdateUserProfile"},"User":{"required":["avatarBytes","avatarUrl","firstname","id","nickname"],"type":"object","properties":{"id":{"type":"integer","description":"Id of user","format":"int64","example":1},"firstname":{"type":"string","description":"Firstname","example":"Nikolai"},"lastname":{"type":"string","description":"Lastname","example":"/v1.0/user/photo?uid=1"},"bio":{"type":"string","description":"Short phrase about user","example":"Talented poet from Petrograd"},"nickname":{"type":"string","description":"Unique nickname on this server","example":"gumilev"},"avatarBytes":{"type":"array","description":"Base64-encoded avatar image thumbnail","example":"iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAIAAACQd1PeAAAAEElEQVR4nGJ6VrQAEAAA//8EQgH7dTCZ8gAAAABJRU5ErkJggg==","items":{"type":"string","description":"Base64-encoded avatar image thumbnail","format":"byte"}},"avatarUrl":{"type":"string","description":"Relative link to user's avatar image","example":"/v1.0/user/photo?uid=1"}}},"SendMessageDto":{"required":["text","type"],"type":"object","properties":{"type":{"pattern":"plain","type":"string","description":"Type of message","example":"plain"},"text":{"maxLength":1000,"minLength":1,"type":"string","description":"Text of message","example":"Hello, world!"}},"description":"Message dto"},"Message":{"required":["date","fromUserId","id","seen","text","toUserId"],"type":"object","properties":{"date":{"type":"string","description":"Date message has been sent","format":"date-time","example":"2001-01-01T03:00:00Z"},"seen":{"type":"boolean","description":"Flag indicates that message is seen","example":false},"id":{"type":"integer","description":"Id of message within given conversation (see toUserId)","format":"int64","example":90},"text":{"type":"string","description":"Text of message","example":"Hello, world!"},"toUserId":{"type":"integer","description":"Id of conversation (user) to which message was sent","format":"int64","example":2},"fromUserId":{"type":"integer","description":"Id of user from message was sent","format":"int64","example":1}}},"FonarConfiguration":{"required":["apiVersionPrefix","salt","server","server_name","server_software_name","server_version","socketUrl"],"type":"object","properties":{"server_version":{"type":"string","description":"Server version","example":"1.0-alpha.4"},"server":{"type":"string","description":"Package name of server (any string)","example":"fonar-message-router-1.0-alpha.4"},"server_software_name":{"type":"string","description":"Name of server software implementation","example":"Fonar Message Router"},"salt":{"type":"string","description":"Salt string which users must create own registration keys with","example":"salt"},"socketUrl":{"type":"string","description":"Full absolute url or :PORT expression to Fonar socket","example":":20777"},"server_name":{"type":"string","description":"Human-readable server namea","example":"DemoServer"},"api_spec":{"type":"string"},"apiVersionPrefix":{"type":"string","description":"Prefix on which Fonar REST API is located","example":"/v1.0"}}},"DialogDto":{"required":["lastMessageIsToMe","unreadMessages"],"type":"object","properties":{"lastMessage":{"$ref":"#/components/schemas/Message"},"user":{"$ref":"#/components/schemas/User"},"lastMessageIsToMe":{"type":"boolean","description":"Indicates that last message was sent to current user.","example":true},"unreadMessages":{"type":"integer","description":"Indicates that last message was sent to current user.","format":"int64"}}}},"securitySchemes":{"fonarAuth":{"type":"apiKey","description":"Key user did call /register API","name":"Authorization","in":"header"}}}}